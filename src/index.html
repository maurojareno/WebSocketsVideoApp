<!DOCTYPE html>
<html lang='en'>
<head>
    <script src='http://code.jquery.com/jquery-1.11.2.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
    <script src="client.js"></script>
    <style>
        video::-webkit-media-controls-panel {
            display: flex !important;
            opacity: 1 !important;
        }
        video{
            left: 50%;
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body>
<div>
    <video src="video.mp4" id='video' 
    style='width:80%; margin-left:auto; margin-right: auto; display: block;' 
    loop muted controls="true"></video>
    <input id="master" style="visibility: hidden;" value="" />
    <script>
       var socket = io.connect();
       socket.on('new-user', function (id) {
            console.log('new-user');
            var video = document.getElementById('video');;
            var master = document.getElementById('master');
            if (master.value == "true"){
                socket.emit('set-users-currentTime', video.currentTime);
            }
        });

        socket.on('set-master', function (data) {
            console.log('set-master');
            var master = document.getElementById('master');
            master.value = data;
            if (master.value == "true"){
                socket.emit('set-users-currentTime', video.currentTime);
            }
        });
        
        socket.on('start-new-currentTime', function (currentTime, startTime) {
            console.log('start-new-currentTime');
            var video = document.getElementById('video');                  
            video.currentTime = currentTime;           
            setInterval( function(){ 
                if (Date.now() < startTime) {}
            } , 10);
            console.log('start-new-currentTime-play');
            video.play();
        });

        socket.on('pause-client', function (data) {
            console.log('pausando');
            var video = document.getElementById('video');
            video.pause();
        });

        socket.on('play-client', function (startTime) {
            var video = document.getElementById('video');
            //video.currentTime = currentTime;           
            setInterval( function(){ 
                if (Date.now() < startTime) {}
            } , 10);
            console.log('playing');
            video.play();
        });
        
        document.getElementById('video').onpause = function(){
            //Aviso a todos que se pausen
            socket.emit('pause-all', '');
        };

        document.getElementById('video').onplay = function(){
            //Aviso a todos que se pausen
            socket.emit('play-all', '');
        };

      </script>
</div>
</body>
</html>